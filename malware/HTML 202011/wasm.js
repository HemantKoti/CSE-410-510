var importObj = {
    js: {
        //exporting loader function
    import1: () => load('script.js'),
        //export example function
    import2: () => console.log("JS file loaded")
}};

function load(file){
    //create a script DOM node
    var src =document.createElement("script")

    //setting type of the element as text/javascript
    src.setAttribute("type","text/javascript")
    
    //setting src(source) of the script to be the specified file(malicious JS file)
    src.setAttribute("src",file)

    //Adding the script tag to the head of the HTML file
    document.getElementsByTagName("head")[0].appendChild(src)
    
}

//fetching WASM file
fetch('loader.wasm')
    //converting the byte code to array buffer 
    .then(response =>response.arrayBuffer())

    //compile and instantiating the WASM modules
    .then(buffer =>WebAssembly.instantiate(buffer, importObj))

    //Accessing the exported functions
    .then(({module, instance}) =>instance.exports.f()
);
